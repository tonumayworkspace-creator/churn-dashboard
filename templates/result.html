<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Churn Prediction — Result</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://rsms.me/inter/inter.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <div class="app-shell">

      <div class="header" style="margin-bottom:6px;">
        <div class="brand">
          <div class="logo">CD</div>
          <div>
            <div class="h1">Churn Prediction</div>
            <div class="h2">Result</div>
          </div>
        </div>

        <div style="text-align:right">
          {% if user %}
            <div style="font-size:0.9rem; color:var(--muted)">Signed in as <strong>{{ user }}</strong></div>
            <div style="margin-top:6px;"><a href="{{ url_for('logout') }}" class="btn btn-ghost">Log out</a></div>
          {% else %}
            <a href="{{ url_for('login') }}" class="btn btn-ghost">Log in</a>
          {% endif %}
        </div>
      </div>

      <div style="display:flex; gap:18px; align-items:flex-start;">
        
        <!-- LEFT: Prediction Result -->
        <div style="flex:1;">
          <div class="card">
            <h3 style="margin:0 0 6px 0;">Prediction summary</h3>
            <p style="margin:0; color:var(--muted)">Probability that this customer will churn:</p>

            <div style="display:flex; align-items:center; gap:18px; margin-top:12px;">
              <div>
                <div class="result-score">{{ result.probability_pct }}<span style="font-size:0.9rem;">%</span></div>
                <div style="color:var(--muted); margin-top:6px;">Model confidence</div>
              </div>

              <div style="flex:1;">
                <div class="progress-bar">
                  <div class="progress-fill" style="width: {{ result.probability_pct }}%;"></div>
                </div>
              </div>
            </div>

            <div style="margin-top:14px;">
              {% if result.prediction == 1 %}
                <div style="padding:10px; background:#fff1f2; color:#7f1d1d; font-weight:700; border-radius:8px;">Customer likely to churn</div>
              {% else %}
                <div style="padding:10px; background:#ecfdf5; color:#065f46; font-weight:700; border-radius:8px;">Customer unlikely to churn</div>
              {% endif %}
            </div>

            {% if result.shap_image %}
            <div style="margin-top:18px;">
              <h4>Top feature contributions (SHAP)</h4>
              <img src="{{ url_for('static', filename=result.shap_image) }}" style="width:100%; max-width:680px;">
            </div>
            {% endif %}
          </div>
        </div>

        <!-- RIGHT: Last Predictions -->
        <div style="width:340px;">
          <div class="metric card">
            <h3>Last Predictions</h3>
            {% if last_predictions %}
              <ul style="padding-left:14px;">
                {% for p in last_predictions %}
                <li style="margin-bottom:8px;">
                  <div style="font-weight:700;">
                    {{ (p.probability * 100) | round(2) }}% —
                    {{ 'Churn' if p.prediction == 1 else 'No Churn' }}
                  </div>
                  <div style="font-size:0.85rem; color:var(--muted);">
                    {{ p.timestamp }}
                  </div>
                </li>
                {% endfor %}
              </ul>
            {% else %}
              <div style="color:var(--muted);">No predictions yet.</div>
            {% endif %}
          </div>
        </div>

      </div>

      <div class="footer">Built with local model</div>

    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
  </body>
</html>
